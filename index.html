<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ハングル・連音化シミュレーター</title>
    <style>
        :root { --primary: #2c3e50; --accent: #27ae60; --bg: #f8f9fa; }
        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { display: flex; gap: 20px; max-width: 900px; width: 100%; }
        .editor, .result-area { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .editor { flex: 1; }
        .result-area { flex: 1.5; min-height: 350px; }
        .current-char { font-size: 80px; font-weight: bold; border: 2px solid var(--accent); border-radius: 10px; margin-bottom: 10px; height: 120px; display: flex; align-items: center; justify-content: center; background: #fff; }
        .controls label { display: block; font-size: 12px; color: #666; margin-top: 10px; }
        select { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; font-size: 16px; }
        button { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 15px; }
        .word-display { font-size: 45px; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; min-height: 60px; }
        .pronunciation { font-size: 18px; color: #e67e22; margin-top: 10px; }
        .romaji-list { font-size: 20px; color: #7f8c8d; }
        .clear-btn { background: #95a5a6; }
        .badge { font-size: 12px; background: #e74c3c; color: white; padding: 2px 6px; border-radius: 4px; vertical-align: middle; }
    </style>
</head>
<body>

<h2>ハングル・連音化シミュレーター</h2>

<div class="container">
    <div class="editor">
        <div class="current-char" id="preview-char"></div>
        <div class="controls">
            <label>初声 (子音)</label><select id="cho" onchange="updatePreview()"></select>
            <label>中声 (母音)</label><select id="jung" onchange="updatePreview()"></select>
            <label>終声 (パッチム)</label><select id="jong" onchange="updatePreview()"></select>
        </div>
        <button onclick="addChar()">文字を追加 ＋</button>
        <button class="clear-btn" onclick="clearAll()">リセット</button>
    </div>

    <div class="result-area">
        <h3>表記</h3>
        <div class="word-display" id="word-out"></div>
        <h3>読み（ローマ字）</h3>
        <div class="romaji-list" id="romaji-out"></div>
        <div id="liaison-note" class="pronunciation"></div>
    </div>
</div>

<script>
const choList = ["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
const jungList = ["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"];
const jongList = ["なし","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];

const cRom = ["g","kk","n","d","tt","r","m","b","pp","s","ss","","j","jj","ch","k","t","p","h"];
const vRom = ["a","ae","ya","yae","eo","e","yeo","ye","o","wa","wae","oe","yo","u","wo","we","wi","yu","eu","ui","i"];
const pRom = ["","k","kk","k","n","n","n","t","l","k","m","l","l","l","p","l","m","p","p","t","t","ng","t","t","k","t","p","t"];

let history = [];

function init() {
    const fill = (id, list) => {
        const el = document.getElementById(id);
        list.forEach((char, i) => {
            let opt = document.createElement("option");
            opt.value = i; opt.innerText = char;
            if(id === 'cho' && i === 11) opt.selected = true;
            el.appendChild(opt);
        });
    };
    fill("cho", choList); fill("jung", jungList); fill("jong", jongList);
    updatePreview();
}

function updatePreview() {
    const c = parseInt(document.getElementById('cho').value);
    const v = parseInt(document.getElementById('jung').value);
    const p = parseInt(document.getElementById('jong').value);
    const code = (c * 21 * 28) + (v * 28) + p + 0xAC00;
    document.getElementById('preview-char').innerText = String.fromCharCode(code);
}

function addChar() {
    const c = parseInt(document.getElementById('cho').value);
    const v = parseInt(document.getElementById('jung').value);
    const p = parseInt(document.getElementById('jong').value);
    
    history.push({ c, v, p, char: String.fromCharCode((c * 21 * 28) + (v * 28) + p + 0xAC00) });
    render();
}

function render() {
    let word = "";
    let romaji = [];
    let liaisonMsg = "";

    for (let i = 0; i < history.length; i++) {
        let cur = history[i];
        word += cur.char;
        
        let r = cRom[cur.c] + vRom[cur.v] + pRom[cur.p];
        
        // 連音化チェック: 前の文字にパッチムがあり、今の文字の初声が 'ㅇ' (index 11)
        if (i > 0 && history[i-1].p > 0 && cur.c === 11) {
            let prevP = pRom[history[i-1].p];
            // 簡易ローマ字書き換え (例: an-yeong -> a-nyeong)
            romaji[i-1] = romaji[i-1].slice(0, -prevP.length); 
            r = prevP + r;
            liaisonMsg = "⚠️ 連音化が発生しています";
        }
        romaji.push(r);
    }

    document.getElementById('word-out').innerText = word;
    document.getElementById('romaji-out').innerText = romaji.join("-");
    document.getElementById('liaison-note').innerHTML = liaisonMsg;
}

function clearAll() {
    history = [];
    render();
}

init();
</script>
</body>
</html>
