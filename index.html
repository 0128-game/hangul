<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ハングル・ドラッグ・ビルダー</title>
    <style>
        :root {
            --cho-c: #ffab19; --jung-c: #4cbf39; --jong-c: #4ca5ff;
            --slot-bg: #e0e0e0;
        }
        body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; }
        
        /* 型選択エリア */
        .templates { display: flex; gap: 10px; margin: 20px; }
        .tpl-card { 
            padding: 10px 20px; background: white; border: 2px solid #ddd; border-radius: 8px; 
            cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        .tpl-card:hover { border-color: var(--cho-c); }
        .tpl-card.active { border-color: var(--cho-c); background: #fff8e1; transform: scale(1.05); }

        .main-layout { display: flex; gap: 30px; width: 900px; height: 600px; }

        /* パレット */
        .palette { 
            width: 300px; background: white; border-radius: 12px; padding: 15px; 
            overflow-y: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .block-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        
        .draggable-block {
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            border-radius: 8px; color: white; font-weight: bold; cursor: grab;
            user-select: none; box-shadow: 0 3px 0 rgba(0,0,0,0.2);
        }
        .draggable-block:active { cursor: grabbing; }

        /* ワークスペース */
        .workspace { 
            flex: 1; background: #fff; border-radius: 12px; padding: 20px;
            display: flex; flex-direction: column; align-items: center; position: relative;
        }

        /* 動的スロットエリア */
        .drop-zone-container { 
            height: 250px; display: flex; align-items: center; justify-content: center; 
            background: #fafafa; border: 3px dashed #eee; width: 100%; border-radius: 15px;
        }
        .slot {
            width: 80px; height: 80px; border-radius: 12px; background: var(--slot-bg);
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; color: white; font-weight: bold; margin: 10px;
            transition: 0.3s; position: relative;
        }
        .slot::after { content: attr(data-label); position: absolute; bottom: -25px; font-size: 12px; color: #999; }
        .slot.drag-over { background: #bbb; transform: scale(1.1); }
        
        /* 完成文字表示 */
        #result-display { font-size: 100px; margin: 20px; font-family: "Malgun Gothic", sans-serif; }
        
        .btns { display: flex; gap: 10px; width: 100%; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<h3>1. 型を選んでください</h3>
<div class="templates">
    <div class="tpl-card" onclick="setTemplate('cv')">子音＋母音</div>
    <div class="tpl-card" onclick="setTemplate('cvp')">子音＋母音＋パッチム</div>
    <div class="tpl-card" onclick="setTemplate('ccv')">子音＋合成母音</div>
    <div class="tpl-card" onclick="setTemplate('ccvp')">子音＋合成母音＋パッチム</div>
</div>

<div class="main-layout">
    <div class="palette">
        <div style="font-size:12px; color:#888;">ドラッグして右へ運ぶ</div>
        <div id="cho-p" class="block-grid"></div>
        <hr>
        <div id="jung-p" class="block-grid"></div>
        <hr>
        <div id="jong-p" class="block-grid"></div>
    </div>

    <div class="workspace">
        <div id="result-display">?</div>
        
        <div class="drop-zone-container" id="drop-zone-container">
            </div>

        <div class="btns" style="margin-top: 20px;">
            <button class="btn" style="background: #4caf50;" onclick="addToOutput()">確定して追加</button>
            <button class="btn" style="background: #2196f3;" onclick="speak()">音声を聴く</button>
            <button class="btn" style="background: #f44336;" onclick="resetWorkspace()">クリア</button>
        </div>
        <div id="final-string" style="font-size: 30px; margin-top: 20px; border-bottom: 2px solid #333; min-width: 100px; text-align: center;"></div>
    </div>
</div>

<script>
const CHO = ["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
const JUNG = ["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"];
const JONG = ["なし","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];

let currentIndices = { cho: 11, jung: 0, jong: 0 };
let fullText = "";

// 初期化
function init() {
    renderPalette('cho-p', CHO, 'cho', '#ffab19');
    renderPalette('jung-p', JUNG, 'jung', '#4cbf39');
    renderPalette('jong-p', JONG, 'jong', '#4ca5ff');
    setTemplate('cv');
}

function renderPalette(id, list, type, color) {
    const container = document.getElementById(id);
    list.forEach((char, i) => {
        if(char === "なし") return;
        const b = document.createElement('div');
        b.className = 'draggable-block';
        b.style.backgroundColor = color;
        b.innerText = char;
        b.draggable = true;
        b.ondragstart = (e) => {
            e.dataTransfer.setData('type', type);
            e.dataTransfer.setData('index', i);
            e.dataTransfer.setData('char', char);
        };
        container.appendChild(b);
    });
}

function setTemplate(type) {
    const container = document.getElementById('drop-zone-container');
    container.innerHTML = '';
    document.querySelectorAll('.tpl-card').forEach(c => c.classList.remove('active'));
    
    // 型に応じたスロット生成
    const slots = {
        'cv': ['cho', 'jung'],
        'cvp': ['cho', 'jung', 'jong'],
        'ccv': ['cho', 'jung', 'jung'], // 合成母音用（簡易的に2つ）
        'ccvp': ['cho', 'jung', 'jung', 'jong']
    };

    slots[type].forEach(role => {
        const s = document.createElement('div');
        s.className = 'slot';
        s.dataset.role = role;
        s.dataset.label = role === 'cho' ? '初声' : (role === 'jung' ? '母音' : 'パッチム');
        s.style.backgroundColor = role === 'cho' ? '#fff3e0' : (role === 'jung' ? '#e8f5e9' : '#e3f2fd');
        
        s.ondragover = (e) => { e.preventDefault(); s.classList.add('drag-over'); };
        s.ondragleave = () => s.classList.remove('drag-over');
        s.ondrop = (e) => {
            e.preventDefault();
            s.classList.remove('drag-over');
            const blockType = e.dataTransfer.getData('type');
            if(blockType === role) {
                s.innerText = e.dataTransfer.getData('char');
                s.style.backgroundColor = blockType === 'cho' ? '#ffab19' : (blockType === 'jung' ? '#4cbf39' : '#4ca5ff');
                currentIndices[role] = parseInt(e.dataTransfer.getData('index'));
                updateResult();
            }
        };
        container.appendChild(s);
    });
}

function updateResult() {
    const code = (currentIndices.cho * 588) + (currentIndices.jung * 28) + currentIndices.jong + 44032;
    document.getElementById('result-display').innerText = String.fromCharCode(code);
}

function addToOutput() {
    fullText += document.getElementById('result-display').innerText;
    document.getElementById('final-string').innerText = fullText;
}

function resetWorkspace() {
    setTemplate('cv');
    currentIndices = { cho: 11, jung: 0, jong: 0 };
    document.getElementById('result-display').innerText = "?";
}

function speak() {
    const u = new SpeechSynthesisUtterance(fullText || document.getElementById('result-display').innerText);
    u.lang = 'ko-KR';
    window.speechSynthesis.speak(u);
}

init();
</script>
</body>
</html>
