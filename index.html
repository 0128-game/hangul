<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ハングル・スクラッチ・ビルダー</title>
    <style>
        :root {
            --cho-color: #ffab19;   /* 初声: オレンジ */
            --jung-color: #4cbf39;  /* 中声: 緑 */
            --jong-color: #4ca5ff;  /* 終声: 青 */
            --bg-dark: #1e1e1e;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; justify-content: center; padding: 20px; }
        
        .container { width: 100%; max-width: 800px; display: grid; grid-template-columns: 300px 1fr; gap: 20px; }

        /* 左側：パレット（ブロック置き場） */
        .palette { background: #fff; border-radius: 12px; padding: 15px; height: 85vh; overflow-y: auto; border: 1px solid #ddd; }
        .palette-section { margin-bottom: 20px; }
        .palette-title { font-size: 12px; font-weight: bold; margin-bottom: 8px; color: #666; text-transform: uppercase; }
        
        /* ブロックの基本スタイル */
        .scratch-block {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 8px 12px; margin: 4px; border-radius: 4px 15px 15px 4px;
            color: white; font-weight: bold; cursor: pointer; user-select: none;
            box-shadow: 0 2px 0 rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        .scratch-block:active { transform: translateY(2px); box-shadow: none; }
        .b-cho { background: var(--cho-color); }
        .b-jung { background: var(--jung-color); }
        .b-jong { background: var(--jong-color); }

        /* 右側：ワークスペース */
        .workspace { background: white; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; border: 1px solid #ddd; }
        
        /* 組み立てエリア */
        .assembly-line {
            background: #f9f9f9; border: 2px solid #eee; border-radius: 15px;
            padding: 30px; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 20px;
        }
        .slot {
            width: 70px; height: 50px; border-radius: 8px; border: 3px dashed #ccc;
            display: flex; align-items: center; justify-content: center; color: #ccc; font-weight: bold;
        }
        .slot.filled { border-style: solid; color: white; }

        /* 出力エリア */
        .preview-circle { width: 120px; height: 120px; background: white; border: 5px solid var(--cho-color); border-radius: 50%; 
                          margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 60px; font-weight: bold; }
        
        .output-text { font-size: 40px; border-bottom: 4px solid #eee; min-height: 60px; margin-bottom: 10px; padding: 10px; }
        
        .control-panel { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
        .btn-add { background: #4cbf39; }
        .btn-speak { background: #4ca5ff; }
        .btn-clear { background: #ff4c4c; }
    </style>
</head>
<body>

<div class="container">
    <div class="palette">
        <div class="palette-section">
            <div class="palette-title">初声 (Consonant)</div>
            <div id="p-cho"></div>
        </div>
        <div class="palette-section">
            <div class="palette-title">中声 (Vowel)</div>
            <div id="p-jung"></div>
        </div>
        <div class="palette-section">
            <div class="palette-title">終声 (Batchim)</div>
            <div id="p-jong"></div>
        </div>
    </div>

    <div class="workspace">
        <div class="preview-circle" id="preview-char">?</div>

        <div class="assembly-line">
            <div id="slot-cho" class="slot">初声</div>
            <div style="font-size: 24px; color: #ccc;">+</div>
            <div id="slot-jung" class="slot">中声</div>
            <div style="font-size: 24px; color: #ccc;">+</div>
            <div id="slot-jong" class="slot">終声</div>
        </div>

        <div class="control-panel">
            <button class="btn btn-add" onclick="commitChar()">文字を追加する</button>
            <button class="btn btn-clear" onclick="clearSlots()">リセット</button>
        </div>

        <div class="output-text" id="final-text"></div>
        
        <div class="control-panel">
            <button class="btn btn-speak" onclick="speakText()">再生 (音声)</button>
            <button class="btn btn-clear" onclick="deleteLast()">1字削除</button>
        </div>
    </div>
</div>

<script>
const CHO = ["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
const JUNG = ["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"];
const JONG = ["(なし)","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];

let selectedCho = 11; // ㅇ
let selectedJung = 0; // ㅏ
let selectedJong = 0; // なし
let textStack = "";

function createPalette() {
    const setup = (containerId, list, type) => {
        const container = document.getElementById(containerId);
        list.forEach((char, i) => {
            const b = document.createElement('div');
            b.className = `scratch-block b-${type}`;
            b.innerText = char;
            b.onclick = () => selectBlock(type, i, char);
            container.appendChild(b);
        });
    };
    setup('p-cho', CHO, 'cho');
    setup('p-jung', JUNG, 'jung');
    setup('p-jong', JONG, 'jong');
}

function selectBlock(type, index, char) {
    const slot = document.getElementById(`slot-${type}`);
    slot.innerText = char === "(なし)" ? "✕" : char;
    slot.className = `slot filled b-${type}`;
    
    if(type === 'cho') selectedCho = index;
    if(type === 'jung') selectedJung = index;
    if(type === 'jong') selectedJong = index;
    
    updatePreview();
}

function updatePreview() {
    const code = (selectedCho * 588) + (selectedJung * 28) + selectedJong + 44032;
    document.getElementById('preview-char').innerText = String.fromCharCode(code);
}

function commitChar() {
    const char = document.getElementById('preview-char').innerText;
    textStack += char;
    document.getElementById('final-text').innerText = textStack;
}

function clearSlots() {
    selectedCho = 11; selectedJung = 0; selectedJong = 0;
    ['cho','jung','jong'].forEach(t => {
        const s = document.getElementById(`slot-${t}`);
        s.className = 'slot';
        s.innerText = t === 'cho' ? '初声' : (t === 'jung' ? '中声' : '終声');
    });
    updatePreview();
}

function deleteLast() {
    textStack = textStack.slice(0, -1);
    document.getElementById('final-text').innerText = textStack;
}

function speakText() {
    const msg = new SpeechSynthesisUtterance(textStack);
    msg.lang = 'ko-KR';
    window.speechSynthesis.speak(msg);
}

createPalette();
updatePreview();
</script>
</body>
</html>
